java基础 之 从Class.forName()跟.class的区别看类的初始化

代码如下：

```java
public class Test {
    public static void main(String[] args) throws Exception {
        System.out.println("调用.class");
        Class<Main> mainClass = Main.class;
        System.out.println("调用Class.forName()");
        Class<?> aClass = Class.forName("com.study.spring.transaction.classdemo.Main");
    }
}
public class Main {
    static {
        System.out.println("初始化");
    }
}
```

运行main方法，结果如下：

```

```

​	从这里我们可以知道，Class.forName会自动初始化这个Class对象，而.class的方式，并不会初始化该Class对象。说到这里，我们要先解释下什么是Class对象。

​	我们知道，类是程序的一部分，每个类都有一个Class对象。换言之，每当编写并且编译了一个新类就会产生一个Class对象。为了生成这个类的对象，运行这个程序的java虚拟机将使用被称为“类加载器”的子系统。

​	类加载器子系统实际上可以包涵一条类加载器链，但是只有一个原生类加载器，它是jvm实现的一部分。原生类加载器加载的是所谓的可信类，包括java API类，它们通常从本地盘加载的。在这条链中，通常不需要添加额外的类加载器，但是如果你有特殊需求（例如以某种特殊的方式加载类，以支持web服务器，或者在网络中下载类），那么你有一种方式可以挂接额外的类加载器。

​	所有的类都是在对其第一次使用时，动态加载到JVM中的。**当程序创建第一个对类的静态成员的引用时，就会加载这个类**。因此，java程序在它开始运行之前并非被完全加载，其各个部分是在必须时才加载的。这一点与许多传统语言都不同。

​	类加载器首先检查这个类的Class对象是否已经加载。如果尚未加载，默认的类加载器就会根据类名查找.class文件（例如，某个类加载器可能会在数据库中查找字节码）。在这个类的字节码被加载时，它们会接受验证，以确保其没有被破坏，并且不包含不良java代码（这是java种用于安全防范目的的措施之一）。

​	为了使用类而做的准备工作实际包含三个步骤：

- 加载，这是由类加载器执行的。该步骤将查找字节码（通常在classpath路径下查找，但这并非是必须的），并且中这些字节码中创建一个class对象
- 链接，在链接阶段将验证类中的字节码，为静态域分配存储空间，并且如果必需的话，将解析这个类创建的对其他类的所有引用
- 初始化，如果该类具有超类，则对其初始化，执行静态初始化器和静态初始化块

当我们使用.class的方式时，初始化被延迟到了对静态方法或者是非常数静态域进行首次引用时才执行。

